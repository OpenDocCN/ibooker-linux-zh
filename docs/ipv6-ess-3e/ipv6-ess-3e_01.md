## 序言

本书讲述的是下一代互联网协议。我们已经熟悉了 IPv4 的优缺点；我们知道如何设计和配置它，也学会了如何排除故障。现在我们还要学习一个新协议吗？从头开始吗？其实不需要。IPv6 的设计者们从超过 15 年的 IPv4 经验中汲取了大量教训，并自 1990 年代初开始着手研发新协议。他们保留了 IPv4 的优点，将地址空间从 32 位扩展到 128 位，并添加了 IPv4 中缺失的功能。他们还开发了过渡机制，使得 IPv4 和 IPv6 能够和平共存，并确保协议间的平稳过渡。事实上，这是新协议版本开发的一个重要要求。

所以你不需要忘记你对 IPv4 的了解；许多东西在 IPv6 中会显得很熟悉。当你开始使用时，你会发现一些新特性和功能，这些将大大简化你的生活。IPv6 拥有一些 IPv4 所没有的特性，这些特性是你未来网络中所需要的。

IPv6 中的一个酷炫功能是无状态自动配置功能。我们不是一直在为 IP 地址分配而苦恼吗？DHCP 的出现让我们的生活变得更简单，但现在我们需要维护和排除 DHCP 服务器的故障。而当我们的冰箱、游泳池、暖气系统以及智能手机和电视都需要拥有 IP 地址时，我们还需要家里有 DHCP 服务器吗？不需要，使用无状态自动配置就能解决。如果你有一台支持 IPv6 的主机，你可以将它插入到网络中，它会自动配置一个有效的 IPv6 地址。ICMP（互联网控制报文协议），作为网络工程师的好帮手，随着 IPv6 变得更加强大。IPv6 的许多新特性，如无状态自动配置、优化的组播路由和组播组管理、邻居发现、路径 MTU 发现和移动 IPv6，都是基于 ICMPv6 的。

我希望这本书能帮助你熟悉这个协议，并为你提供一个易于理解的切入点，带你探索这一新领域。

## 读者

本书涵盖了关于 IPv6 的广泛信息，是任何希望理解或实施该协议的人的优秀资源。它对于开发应用程序的人来说也是一本不错的读物。IPv6 提供了我们在 IPv4 中没有的功能，因此可能为应用程序打开新的可能性。无论你是公司的所有者或经理，还是 IT 部门的负责人；无论你是系统或网络管理员、工程师或网络设计师；或是对 IPv6 带来的重要变化感兴趣的人，本书都会讨论经济和战略方面的内容，以及技术细节。我描述了确保 IPv6 平稳引入的互操作机制和场景。如果你是公司所有者或经理，你会对第七章和第九章最感兴趣。如果你需要规划企业网络战略，第一章、第四章、第五章、第七章和第九章将是你最关注的内容。如果你管理公司的基础设施，你尤其会对第四章和第五章感兴趣，这些章节涵盖了 ICMPv6、第二层问题和路由，还包括第七章和第九章，这些章节涉及过渡机制、互操作性和规划。如果你是系统或网络管理员，那么本书的所有章节都与您相关：它为 IPv6 的实施和与 IPv4 的集成提供了基础。

## 关于本书

本书详细介绍了 IPv6，解释了所有新的特性和功能。它将展示如何在当前的 IPv4 基础设施中规划、设计和集成 IPv6。

本书假定你对网络问题有较好的理解，并熟悉 IPv4。书中不涉及详细讨论 IPv4 的概念。必要时我会提到它们，但如果你想深入了解 IPv4，市场上有许多优秀的资源可供参考。你可以在附录 B 中找到书单。

本书旨在通过解释 IPv6 的所有高级功能，激发你重新思考未来的网络和服务概念，并为真正的下一代网络奠定基础。

## 组织结构

本书的组织方式是，熟悉 IPv4 的读者可以通过阅读第二章到第七章，轻松了解 IPv6 中的新特性。这些章节涵盖了你需要了解的内容，包括寻址、新的 IPv6 头部、ICMPv6、第二层、路由协议、DNS 和 DHCPv6、安全性、服务质量（QoS），以及使 IPv6 与 IPv4 在不同过渡阶段协同工作的过渡机制。移动 IPv6 将在第八章中讨论。第九章涉及规划过程和需要考虑的事项，并将所有技术要素整合在一起。以下是本书的章节分解：

+   第一章，*为什么选择 IPv6？*，简要说明了 IPv6 的历史，并概述了新功能。它勾画了互联网和服务演进的宏大图景，展示了 IPv6 的大地址空间和先进功能在不同方面的需求。接着讨论了阻碍人们探索和集成该协议的最常见误解。最后，解释了何时是启动 IPv6 项目并推动集成的合适时机。

+   第二章，*IPv6 寻址*，解释了你需要了解的关于新地址架构、地址格式、地址表示法、地址类型、国际注册服务和前缀分配的所有内容。

+   第三章，*IPv6 协议的结构*，描述了新的 IPv6 头部格式，并讨论了每个字段以及跟踪文件示例。还介绍了扩展头部是什么、已定义的扩展头部类型以及如何使用它们。

+   第四章，*ICMPv6*，描述了新的 ICMPv6 消息格式、ICMPv6 错误消息和信息消息，以及跟踪文件中的 ICMPv6 头部。本章还讨论了基于 ICMPv6 的扩展功能，如邻居发现、自动配置、路径 MTU 发现和多播侦听器发现（MLD）。你将学习 ICMPv6 如何使管理员的工作变得更加轻松。

+   第五章，*网络*，涵盖了多个与网络相关的方面和服务，例如 IPv6 的第二层支持、上层协议和校验和、所有多播相关主题的概述、路由协议概述、服务质量（QoS）、DHCPv6 和 DNS。

+   第六章，*IPv6 安全性*，从简要讨论基本安全概念和需求开始。然后介绍 IPsec 框架、IPv6 中可用于身份验证和加密的安全元素，以及如何使用它们。我们的未来网络将需要新的安全架构。本章提供了在定义 IPv6 安全概念时需要考虑的事项概述。

+   第七章，*过渡技术*，讨论了已定义的不同过渡机制，如双栈操作和不同的隧道及翻译技术。它还展示了如何使用和组合这些技术，以确保和平共存和平稳过渡。这是你规划高效且节省成本的过渡工具包。

+   第八章，*移动 IPv6*，介绍了移动 IPv6。本章解释了为什么这项技术可能成为新一代移动服务的基础。它还展示了 IPv6 的扩展头部支持如何提供 IPv4 无法实现的功能。

+   第九章，*IPv6 规划*，将所有内容汇总成一个大局面。它讨论了规划过程、成功标准、集成场景、最佳实践，并根据我长期的咨询经验总结了该做与不该做的事项。

+   附录 A，包括对 RFC 过程和相关机构的简短介绍，并提供了与 IPv6 相关的 RFC 列表。

+   附录 B，提供了我推荐的书籍列表。

### 注意

一些重要的主题和信息在书中出现多次。这不是因为我想让你感到无聊，而是因为我假设大多数读者不会从第一页读到最后一页，而是根据兴趣选择章节和部分。因此，如果信息在不同部分和上下文中都很重要，我可能会再次提到它。

## 本书中使用的约定

本书中使用了以下排版约定：

*斜体*

表示新术语、网址、电子邮件地址、文件名和文件扩展名。

`常量宽度`

用于程序列表展示，以及在段落中引用程序元素，如变量名、函数名、数据库、数据类型、环境变量、语句和关键字。

**`常量宽度粗体`**

显示用户应按字面输入的命令或其他文本。

*`常量宽度斜体`*

显示应由用户提供的值或由上下文决定的值所替换的文本。

### 提示

该元素表示一个提示或建议。

### 注意

该元素表示一般性说明。

### 警告

该元素表示警告或注意事项。

## Safari® 在线图书

### 注意

[Safari Books Online](http://my.safaribooksonline.com/?portal=oreilly) 是一个按需数字图书馆，提供来自世界顶尖技术和商业作者的专家 [内容](http://www.safaribooksonline.com/content)，包括书籍和视频形式。

技术专业人员、软件开发人员、网页设计师以及商业和创意专业人士使用 Safari Books Online 作为他们进行研究、解决问题、学习和认证培训的主要资源。

Safari Books Online 提供多种 [产品组合](http://www.safaribooksonline.com/subscriptions) 和定价方案，适用于 [组织](http://www.safaribooksonline.com/organizations-teams)、[政府机构](http://www.safaribooksonline.com/government) 和 [个人](http://www.safaribooksonline.com/individuals)。订阅者可以访问成千上万本书籍、培训视频和预发布手稿，这些内容来自如 O’Reilly Media、Prentice Hall Professional、Addison-Wesley Professional、Microsoft Press、Sams、Que、Peachpit Press、Focal Press、Cisco Press、John Wiley & Sons、Syngress、Morgan Kaufmann、IBM Redbooks、Packt、Adobe Press、FT Press、Apress、Manning、New Riders、McGraw-Hill、Jones & Bartlett、Course Technology 等出版商的数据库，并且这个数据库完全可以搜索。有关 Safari Books Online 的更多信息，请访问我们的网站 [在线](http://www.safaribooksonline.com/)。

## 联系我们方式

请将有关本书的评论和问题发送给出版商：

| O'Reilly Media, Inc. |
| --- |
| 1005 Gravenstein Highway North |
| Sebastopol, CA 95472 |
| 800-998-9938（美国或加拿大） |
| 707-829-0515（国际或本地） |
| 707-829-0104（传真） |

本书有一个网页，我们在此列出了勘误表、示例以及任何其他信息。您可以通过以下链接访问该页面 [`bit.ly/ipv6-3e`](http://bit.ly/ipv6-3e)。

如果您对本书有评论或技术问题，请发送电子邮件至 bookquestions@oreilly.com。

有关我们的书籍、课程、会议和新闻的更多信息，请访问我们的网站 [`www.oreilly.com`](http://www.oreilly.com)。

在 Facebook 上找到我们：[`facebook.com/oreilly`](http://facebook.com/oreilly)

在 Twitter 上关注我们：[`twitter.com/oreillymedia`](http://twitter.com/oreillymedia)

在 YouTube 上观看我们：[`www.youtube.com/oreillymedia`](http://www.youtube.com/oreillymedia)

## 致谢

世界各地有许多人为本书做出了贡献。没有他们的帮助和意见，这本书不会变成现在的样子。

对于第一版，特别感谢 Anja Spittler（Maggy）。在 IPv6 的早期，她在我们的实验室里花费了数小时、数天和数周的时间，设置 SuSE Linux，调试 BIND 和其他服务，并编写了第一版第九章和第十二章的部分内容。我还要感谢技术编辑们，正是他们宝贵的评论、修正和澄清使得这本书变得更加完善。当我在某个话题上遇到困难并需要一些答案时，他们是我宝贵的资源。第一版的技术审阅者是 Patrick Grossetete，他曾在 Cisco 的互联网技术部门（ITD）担任产品经理；还有 Neil Cashell，他是 Novell（现为 SuSE）的一位出色的 TCP/IP 专家。同时也感谢 Brian McGehee，他多年来一直从事 IPv6 的工作，并编写了大量关于 IPv6 的课程。他为第一版进行了最终的技术编辑，并添加了许多有用的信息。我还要感谢 Cisco 瑞士分公司，特别是 René Räber，既为我们提供了更新的路由器和技术资源的访问权限，也为我在 IPv6 方面的工作提供了支持。感谢 SuSE 的伙伴们提供软件并支持我们准备好 IPv6 的 SuSE 主机；感谢微软提供软件和关于其实现的信息；感谢 Network General 提供 Sniffer Pro 软件用于跟踪文件；感谢 Bob Fink 运营 6Bone 网站；感谢 Cricket Liu 解答我的 DNS 问题；感谢 Peter Bieringer 运营一个很棒的互联网资源网站，并以闪电般的速度回答我的问题。

第二版有许多额外的支持者、作者和审阅者，他们包括：来自惠普的 Jim Bound，IPv6 论坛的首席技术官以及 NAv6TF 的主席；IPv6 论坛主席 Latif Ladid；南安普顿大学电子与计算机科学系的 Tim Chown；以及来自 McAfee 的 Vijayabhaskar。来自 Seattle 的 Native6 公司，Yurie Rich、John Spence 和 Mike Owen 对第二版的第一章、第五章、第六章和第十章提供了重要意见。Robin Shepherd 集团的 Gene Cronk 对第五章和第十章提供了重要建议，北美 IPv6 工作组和中大西洋 IPv6 工作组主席 John Jason Brzozowski 对第一章和第九章做出了重要贡献。感谢 SRI 国际的 David B. Green，感谢他授权引用他在第五章中展示的《企业安全模型》演示文稿，并审阅了书中的不同部分。感谢 Double Shot Security 的首席网络安全架构师 Merike Kaeo 对第五章提出的所有意见和评论。感谢微软的 Chris Engdahl 审阅第十章。感谢 Sunny Connection 的 Jimmy Ott 研究并撰写了第十二章的所有更新内容。伴随书籍《IPv6 网络管理》的作者 David Malone 审阅了整本书——感谢你，David，提供的宝贵且具有启发性的评论。非常感谢所有愿意与我分享经验并提供案例研究的人们，他们分别是：来自波尔图大学的 Paolo Vieira，来自斯特拉斯堡大学的 Pierre David，来自 NTT Communications 的 Cody Christman，以及来自苏黎世 Cyberlink AG 的 Flavio Curti 和 Ueli Heuer。来自 IABG 德国的 Wolfgang Fritsche 和来自爱立信 AB 的 Karim El-Malki 审阅并提供了关于移动性的第八章的意见。感谢 Checkpoint 的工作人员提供信息和联系，特别是 Patrik Honegger 和 Yoni Appel；也感谢 Juniper 的 Jean-Marc Uzé提供的信息和联系。我还要感谢所有国际工作组中的人员和开发者，没有他们的远见卓识、热情和不懈努力，我们就无法实现 IPv6 的准备工作。

我想特别纪念*Jim Bound*，他在第二版的致谢中有提到。他多年来是 IPv6 的关键开发者和推动者。他曾是国际 IPv6 论坛的首席技术官（CTO）以及 IETF（互联网工程任务组）IP 下一代委员会的成员。如果没有他的推动、知识和热情，IPv6 也不会有今天的成就。不幸的是，Jim 在 2009 年以 58 岁的年龄过早离世。为了纪念 Jim，*国际 IPv6 论坛*创建了*Jim Bound 奖*，该奖项授予在 IPv6 部署方面具有世界领导力的国家。我有幸获得了第一个 Jim Bound 奖，代表瑞士 IPv6 委员会，瑞士是世界上第一个在 2013 年 4 月达到双位数 IPv6 用户渗透率的国家。

对于这第三版，我很高兴能有许多伟大且知识渊博的帮助者。

首先，我要感谢我的三位主要审阅者，他们审阅了所有章节。他们是 Ed Horley、David Malone 和 Niall Murphy。感谢你们的宝贵意见、思考和启发，也感谢你们抽出时间来做这些工作并回答我的问题。Ed Horley 还是*《Microsoft 管理员实用 IPv6》*的作者，这本书是所有处理 Microsoft 操作系统的人的必读书籍。我还要感谢 Mark Townsley、Cameron Byrne 和 Jan Zorz，他们审阅并为第七章和第九章提供了重要意见，Chip Popoviciu 撰写了 MPLS 部分，Gerd Pflüger 撰写了 LISP 部分，Eric Vyncke 提供了他的意见并审阅了 第六章。我还要感谢我的网络分析大师和 IPv6 培训师 Jasper Bongertz，他帮助改善了 Wireshark 的界面，Uwe Lenz，我的第二位 IPv6 教练。他为我的动手实验课创建了一个很棒的实验室，并用它为本书制作了各种跟踪文件。感谢 Andrew Yourtchenko 和 Gert Döring 回答我提出的许多问题，以及 Jeff Carrell 就 SLAAC 的内部工作机制和我们在跟踪文件中看到的细微差别与我展开了许多有趣的讨论。我还要感谢 Bea Leonhardt，在我写书时管理我的办公室并帮助更新 RFC 列表。还要感谢 Robin Huber，他是一个热情的 IT 人员，帮助我解决基础设施问题，处理我的电脑问题，负责我们 IPv6 会议的后勤工作，并且时刻更新我关于最新游戏设备的信息。最后但同样重要的是，感谢 Latif Ladid，感谢他为 IPv6 社区所做的一切持续贡献，感谢他在我周末工作时给我鼓励，感谢他让 Vint Cerf 为本书的前言提供支持。

还有所有在 O'Reilly 的伟大人物：对于第一版，特别感谢吉姆·萨姆瑟（Jim Sumser）、迈克·卢基德斯（Mike Loukides）和塔蒂安娜·阿潘迪（Tatiana Apandi）。吉姆·萨姆瑟以极大的热情、耐心和经验引导我完成了第一版的整个写作过程。谢谢你，吉姆，感谢你在我已经在挣扎时依然陪伴在我身边，感谢你从未催促我。你真的起到了关键作用！迈克和塔蒂安娜是我在第二版中合作的伙伴，他们在整个过程中也给予了我很大的支持。我还想感谢所有在 O'Reilly 为这本书做出贡献的其他人，特别是蒂姆·欧赖利（Tim O'Reilly），是他让这一切成为可能。对于第三版，我主要是与梅根·布兰切特（Meghan Blanchette）一起合作。梅根，感谢你所做的所有出色工作，感谢你的支持、幽默和在我疯狂的日程安排下对我的耐心。每当我向你求助时，你总是及时出现，帮助我保持进度。

另一个特别的感谢送给汉斯彼得·比特勒（Hanspeter Bütler），他曾是我在学校时的老师，感谢他教我古希腊语言的美妙。他那富有洞察力和敏感的方式引导我理解并感受古老语言的丰富性，为我对语言的一般理解、对不同文化的认识以及不同视角如何通过语言表达的理解奠定了基础。我或许可以部分归功于他，才使我成为了一名作家。语言是用来沟通的，越精确地使用我们的语言，我们就越能理解和被理解。没有沟通，就没有理解。在另一个层面上，TCP/IP 是网络中实现沟通的协议，从而为互联网通信奠定了基础。而互联网为全球沟通创造了物理基础。它为跨越所有文化进行全球交流、分享和理解提供了一个伟大的机会。这就是我们应该如何使用它。
